<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preprocess to Update-Query in Subtree - Tutorial by Md. Emrul Chowdhury</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/modern-style.css">
    <link rel="stylesheet" href="../css/tutorial-style.css">
    
    <!-- Favicon -->
    <link rel='shortcut icon' href='../images/favicon.ico' type='image/x-icon' />
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top modern-nav">
        <div class="container">
            <a class="navbar-brand fw-bold" href="../index.html">
                <span class="brand-highlight">Emrul</span> Chowdhury
            </a>
            
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../competitive-programming-profile.html">Programming</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../problem-setting-profile.html">Problem Setting</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../career-background.html">Career</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html">Tutorials</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Tutorial Header -->
    <section class="tutorial-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <div class="tutorial-breadcrumb">
                        <a href="index.html">
                            <i class="bi bi-arrow-left me-2"></i>Back to Tutorials
                        </a>
                    </div>
                    
                    <div class="tutorial-meta mb-3">
                        <span class="tutorial-category">
                            <i class="bi bi-diagram-3 me-2"></i>Tree Algorithms
                        </span>
                        <span class="tutorial-difficulty expert">Expert</span>
                    </div>
                    
                    <h1 class="tutorial-title">Preprocess to Update-Query in Subtree</h1>
                    
                    <p class="tutorial-subtitle">
                        Master the technique of preprocessing trees to handle subtree update and 
                        query operations efficiently. Essential for advanced tree-based problems 
                        and competitive programming contests.
                    </p>
                    
                    <div class="tutorial-stats">
                        <div class="stat-item">
                            <i class="bi bi-clock me-2"></i>
                            <span>25 min read</span>
                        </div>
                        <div class="stat-item">
                            <i class="bi bi-bar-chart me-2"></i>
                            <span>O(log n) Operations</span>
                        </div>
                        <div class="stat-item">
                            <i class="bi bi-person me-2"></i>
                            <span>By Emrul Chowdhury</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Tutorial Content -->
    <section class="tutorial-content">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="content-wrapper">
                        <!-- Prerequisites -->
                        <div class="content-section">
                            <div class="prerequisites-box">
                                <h4>
                                    <i class="bi bi-list-check me-2"></i>Prerequisites
                                </h4>
                                <ul class="prerequisites-list">
                                    <li><i class="bi bi-check-circle me-2"></i>Segment Tree</li>
                                    <li><i class="bi bi-check-circle me-2"></i>Depth First Search (DFS)</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Introduction -->
                        <div class="content-section">
                            <p class="lead">
                                In this tutorial, we will learn how to preprocess a given tree to update 
                                a node and query in a subtree using a data structure like segment tree.
                            </p>
                            
                            <div class="definition-box">
                                <h5>Definition: Subtree</h5>
                                <p>
                                    A subtree of a tree <strong>T</strong> is a tree consisting of a node in 
                                    <strong>T</strong> and all of its descendants in <strong>T</strong>.
                                </p>
                            </div>

                            <p>
                                We know there are well known data-structures to update and query in subarray 
                                of an array. We can use all of them to query in a subtree. Let's see how 
                                we'll do that!
                            </p>
                        </div>

                        <!-- Problem Setup -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-diagram-3 me-3"></i>Problem Setup
                            </h2>
                            
                            <p>Suppose we have a tree with 7 nodes and the tree looks like the following:</p>

                            <div class="tree-example">
                                <div class="tree-visual">
                                    <img src="images/image3.png" alt="Tree Structure" class="tree-image">
                                </div>
                                
                                <p class="tree-caption">
                                    Example tree with 7 nodes showing the hierarchical structure
                                </p>
                            </div>

                            <p>Let's assume there is a value written in every node. For example, the numbers are as following:</p>

                            <div class="node-values-table">
                                <table class="table table-bordered modern-table">
                                    <thead>
                                        <tr>
                                            <th>Node Number</th>
                                            <th>1</th>
                                            <th>2</th>
                                            <th>3</th>
                                            <th>4</th>
                                            <th>5</th>
                                            <th>6</th>
                                            <th>7</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="table-header">Assigned Value</td>
                                            <td>9</td>
                                            <td>10</td>
                                            <td>11</td>
                                            <td>6</td>
                                            <td>8</td>
                                            <td>12</td>
                                            <td>5</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- The Challenge -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-exclamation-triangle me-3"></i>The Challenge
                            </h2>

                            <p>For example, a tree having node 2 as root is the subtree of the mentioned tree.</p>

                            <div class="tree-example">
                                <div class="tree-visual">
                                    <img src="images/image1.png" alt="Subtree Example" class="tree-image">
                                </div>
                                
                                <p class="tree-caption">
                                    Subtree rooted at node 2, containing nodes 2, 5, and 6
                                </p>
                            </div>

                            <p>
                                So, for an example, if we want to get the maximum value among that subtree, 
                                we need to find the maximum value among the nodes <strong>2</strong>, 
                                <strong>6</strong> and <strong>5</strong>.
                            </p>

                            <div class="highlighted-nodes-table">
                                <table class="table table-bordered modern-table">
                                    <thead>
                                        <tr>
                                            <th>Node Number</th>
                                            <th>1</th>
                                            <th class="highlight-header">2</th>
                                            <th>3</th>
                                            <th>4</th>
                                            <th class="highlight-header">5</th>
                                            <th class="highlight-header">6</th>
                                            <th>7</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="table-header">Assigned Value</td>
                                            <td>9</td>
                                            <td class="highlight-cell">10</td>
                                            <td>11</td>
                                            <td>6</td>
                                            <td class="highlight-cell">8</td>
                                            <td class="highlight-cell">12</td>
                                            <td>5</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="alert alert-warning">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                <strong>Problem:</strong> As we can see, these node indexes do not build 
                                a segment, we are not able to use data-structures to find the maximum efficiently.
                            </div>
                        </div>

                        <!-- The Solution -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-lightbulb me-3"></i>The Solution: DFS Preprocessing
                            </h2>

                            <p>
                                But there is a solution! Let's traverse the tree by DFS fashion and write 
                                the traversal order on these nodes.
                            </p>

                            <div class="tree-example">
                                <div class="tree-visual">
                                    <img src="images/image2.png" alt="DFS Traversal" class="tree-image">
                                </div>
                                
                                <p class="tree-caption">
                                    Tree with DFS traversal order marked on each node
                                </p>
                            </div>

                            <div class="traversal-table">
                                <h5>DFS Traversal Result:</h5>
                                <table class="table table-bordered modern-table">
                                    <thead>
                                        <tr>
                                            <th>Traversal Order</th>
                                            <th>1</th>
                                            <th>2</th>
                                            <th>3</th>
                                            <th>4</th>
                                            <th>5</th>
                                            <th>6</th>
                                            <th>7</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="table-header">Node Number</td>
                                            <td>1</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>7</td>
                                            <td>2</td>
                                            <td>6</td>
                                            <td>5</td>
                                        </tr>
                                        <tr>
                                            <td class="table-header">Assigned Value</td>
                                            <td>9</td>
                                            <td>11</td>
                                            <td>6</td>
                                            <td>5</td>
                                            <td>10</td>
                                            <td>12</td>
                                            <td>8</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <p>Now back to the query part, the candidate nodes of the query are highlighted as follows:</p>

                            <div class="solution-table">
                                <table class="table table-bordered modern-table">
                                    <thead>
                                        <tr>
                                            <th>Traversal Order</th>
                                            <th>1</th>
                                            <th>2</th>
                                            <th>3</th>
                                            <th>4</th>
                                            <th class="highlight-header">5</th>
                                            <th class="highlight-header">6</th>
                                            <th class="highlight-header">7</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="table-header">Node Number</td>
                                            <td>1</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>7</td>
                                            <td class="highlight-cell">2</td>
                                            <td class="highlight-cell">6</td>
                                            <td class="highlight-cell">5</td>
                                        </tr>
                                        <tr>
                                            <td class="table-header">Assigned Value</td>
                                            <td>9</td>
                                            <td>11</td>
                                            <td>6</td>
                                            <td>5</td>
                                            <td class="highlight-cell">10</td>
                                            <td class="highlight-cell">12</td>
                                            <td class="highlight-cell">8</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="alert alert-success">
                                <i class="bi bi-check-circle me-2"></i>
                                <strong>Success!</strong> Now we can see, the traversal order of these nodes 
                                form a segment and we can easily apply data-structure like segment tree to 
                                find the maximum of that subtree having node 2 as root.
                            </div>
                        </div>

                        <!-- Formula and Implementation -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-calculator me-3"></i>Formula and Implementation
                            </h2>

                            <div class="formula-box">
                                <h5>Range Formula for Subtree:</h5>
                                <div class="formula-list">
                                    <div class="formula-item">
                                        <strong>Left most traversal order</strong> = Traversal order of the subtree root
                                    </div>
                                    <div class="formula-item">
                                        <strong>Right most traversal order</strong> = Traversal order of the subtree root + Size of the subtree - 1
                                    </div>
                                </div>
                            </div>

                            <div class="explanation-box">
                                <h5>Explanation:</h5>
                                <p>
                                    If we go back to our example subtree, the left traversal order of the 
                                    highlighted segment is 5, which is the traversal order of node 2, which 
                                    is the root of the subtree. The right traversal order will be the 
                                    last node of that subtree, which can be easily found by adding subtree size.
                                </p>
                            </div>

                            <h4>DFS Implementation:</h4>
                            <p>How we can traverse the tree in DFS fashion and find subtree size:</p>

                            <div class="code-block">
                                <div class="code-header">
                                    <span class="code-title">DFS Preprocessing</span>
                                    <span class="complexity">Time: O(n), Space: O(n)</span>
                                </div>
                                <pre><code class="language-cpp">int traversalOrder = 0;
int sz[Max];
int order[Max];
vector&lt;int&gt; adj[Max];

int dfs(int u) {
    order[u] = ++traversalOrder;
    sz[u] = 1;

    for(int v : adj[u]) {
        if (!order[v]) {
            sz[u] += dfs(v);
        }
    }
    return sz[u];
}</code></pre>
                            </div>

                            <h4>Range Query Function:</h4>
                            <p>Getting traversal order range for a subtree:</p>

                            <div class="code-block">
                                <div class="code-header">
                                    <span class="code-title">Range Calculation</span>
                                    <span class="complexity">Time: O(1), Space: O(1)</span>
                                </div>
                                <pre><code class="language-cpp">pair&lt;int, int&gt; getRange(int root) {
    int rootTraversalOrder = order[root];
    int l = rootTraversalOrder;
    int r = rootTraversalOrder + sz[root] - 1;
    return {l, r};
}</code></pre>
                            </div>
                        </div>

                        <!-- Applications -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-gear me-3"></i>Applications
                            </h2>

                            <div class="applications-grid">
                                <div class="application-item">
                                    <i class="bi bi-plus-circle"></i>
                                    <div>
                                        <h5>Subtree Sum Queries</h5>
                                        <p>Calculate sum of all values in a subtree efficiently</p>
                                    </div>
                                </div>
                                <div class="application-item">
                                    <i class="bi bi-arrow-up-circle"></i>
                                    <div>
                                        <h5>Subtree Maximum/Minimum</h5>
                                        <p>Find maximum or minimum value in any subtree</p>
                                    </div>
                                </div>
                                <div class="application-item">
                                    <i class="bi bi-pencil-square"></i>
                                    <div>
                                        <h5>Subtree Updates</h5>
                                        <p>Update all nodes in a subtree with range update operations</p>
                                    </div>
                                </div>
                                <div class="application-item">
                                    <i class="bi bi-search"></i>
                                    <div>
                                        <h5>Complex Queries</h5>
                                        <p>Any query that can be answered on arrays can now work on subtrees</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Complexity Analysis -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-speedometer2 me-3"></i>Complexity Analysis
                            </h2>

                            <div class="complexity-table">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Operation</th>
                                            <th>Time Complexity</th>
                                            <th>Space Complexity</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>DFS Preprocessing</td>
                                            <td class="complexity-good">O(n)</td>
                                            <td class="complexity-good">O(n)</td>
                                        </tr>
                                        <tr>
                                            <td>Range Calculation</td>
                                            <td class="complexity-excellent">O(1)</td>
                                            <td class="complexity-excellent">O(1)</td>
                                        </tr>
                                        <tr>
                                            <td>Subtree Query (with Segment Tree)</td>
                                            <td class="complexity-good">O(log n)</td>
                                            <td class="complexity-good">O(n)</td>
                                        </tr>
                                        <tr>
                                            <td>Subtree Update (with Segment Tree)</td>
                                            <td class="complexity-good">O(log n)</td>
                                            <td class="complexity-good">O(n)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Key Takeaways -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-key me-3"></i>Key Takeaways
                            </h2>

                            <div class="takeaways-grid">
                                <div class="takeaway-item">
                                    <i class="bi bi-check-circle"></i>
                                    <div>
                                        <h5>DFS Preprocessing</h5>
                                        <p>Convert tree structure to array indices using DFS traversal</p>
                                    </div>
                                </div>
                                <div class="takeaway-item">
                                    <i class="bi bi-check-circle"></i>
                                    <div>
                                        <h5>Subtree to Range</h5>
                                        <p>Map subtree operations to contiguous array range operations</p>
                                    </div>
                                </div>
                                <div class="takeaway-item">
                                    <i class="bi bi-check-circle"></i>
                                    <div>
                                        <h5>Efficient Queries</h5>
                                        <p>Use any array data structure (Segment Tree, Fenwick Tree) on trees</p>
                                    </div>
                                </div>
                                <div class="takeaway-item">
                                    <i class="bi bi-check-circle"></i>
                                    <div>
                                        <h5>Versatile Technique</h5>
                                        <p>Works with any associative operation (sum, max, min, XOR, etc.)</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Conclusion -->
                        <div class="content-section">
                            <div class="conclusion-box">
                                <h4>
                                    <i class="bi bi-check-circle me-2"></i>Conclusion
                                </h4>
                                <p>
                                    Now we can update a node and query over a subtree using a data structure 
                                    like segment tree. This technique is fundamental for solving complex 
                                    tree-based problems efficiently.
                                </p>
                                <p class="mb-0">
                                    Thank you for reading! üòä
                                </p>
                                <div class="publication-date">
                                    <i class="bi bi-calendar me-2"></i>
                                    Published on December 5, 2020
                                </div>
                            </div>
                        </div>

                        <!-- Navigation -->
                        <div class="tutorial-navigation">
                            <a href="submatrix-sum-in-o(1).html" class="nav-btn prev">
                                <i class="bi bi-arrow-left me-2"></i>
                                Previous Tutorial
                            </a>
                            <a href="index.html" class="nav-btn next">
                                Back to Tutorials
                                <i class="bi bi-arrow-right ms-2"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="modern-footer">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="footer-brand">
                        <h5 class="mb-2">Md. Emrul Chowdhury</h5>
                        <p class="mb-0">Software Development Engineer</p>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="social-links">
                        <a href="mailto:emrul.chy@gmail.com" class="social-link" title="Email">
                            <i class="bi bi-envelope"></i>
                        </a>
                        <a href="https://github.com/emrul-chy" target="_blank" class="social-link" title="GitHub">
                            <i class="bi bi-github"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/emrul-cse/" target="_blank" class="social-link" title="LinkedIn">
                            <i class="bi bi-linkedin"></i>
                        </a>
                        <a href="https://www.facebook.com/emrul.cse" target="_blank" class="social-link" title="Facebook">
                            <i class="bi bi-facebook"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <hr class="footer-divider">
            
            <div class="row">
                <div class="col-12 text-center">
                    <p class="copyright mb-0">
                        ¬© 2025 emrul-chy.github.io | Built with ‚ù§Ô∏è by Md. Emrul Chowdhury
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Prism.js for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- Custom JS -->
    <script src="../js/modern-script.js"></script>
</body>
</html>
