<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submatrix Sum in O(1) - Tutorial by Md. Emrul Chowdhury</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/modern-style.css">
    <link rel="stylesheet" href="../css/tutorial-style.css">
    
    <!-- Favicon -->
    <link rel='shortcut icon' href='../images/favicon.ico' type='image/x-icon' />
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top modern-nav">
        <div class="container">
            <a class="navbar-brand fw-bold" href="../index.html">
                <span class="brand-highlight">Emrul</span> Chowdhury
            </a>
            
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../competitive-programming-profile.html">Programming</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../problem-setting-profile.html">Problem Setting</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../career-background.html">Career</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../tools/index.html">Tools</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html">Tutorials</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Tutorial Header -->
    <section class="tutorial-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <div class="tutorial-breadcrumb">
                        <a href="index.html">
                            <i class="bi bi-arrow-left me-2"></i>Back to Tutorials
                        </a>
                    </div>
                    
                    <div class="tutorial-meta mb-3">
                        <span class="tutorial-category">
                            <i class="bi bi-grid-3x3-gap me-2"></i>Matrix Algorithms
                        </span>
                        <span class="tutorial-difficulty advanced">Advanced</span>
                    </div>
                    
                    <h1 class="tutorial-title">Submatrix Sum in O(1)</h1>
                    
                    <p class="tutorial-subtitle">
                        Learn how to efficiently calculate the sum of any submatrix in constant time 
                        using 2D prefix sums. This technique is crucial for solving matrix-based 
                        problems in competitive programming.
                    </p>
                    
                    <div class="tutorial-stats">
                        <div class="stat-item">
                            <i class="bi bi-clock me-2"></i>
                            <span>15 min read</span>
                        </div>
                        <div class="stat-item">
                            <i class="bi bi-bar-chart me-2"></i>
                            <span>O(1) Query Time</span>
                        </div>
                        <div class="stat-item">
                            <i class="bi bi-person me-2"></i>
                            <span>By Emrul Chowdhury</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Tutorial Content -->
    <section class="tutorial-content">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="content-wrapper">
                        <!-- Introduction -->
                        <div class="content-section">
                            <p class="lead">
                                In this tutorial, I'm going to describe a problem and a simple solution 
                                to solve this to learn two dimensional cumulative sums.
                            </p>
                        </div>

                        <!-- Problem Statement -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-question-circle me-3"></i>Problem Statement
                            </h2>
                            
                            <p>
                                You have a 2D matrix <code>mat</code> having n rows and m columns. 
                                You have some assigned numbers in every cell.
                            </p>

                            <p>
                                You need to do some queries, in every query you need to print the sum of 
                                the submatrix. You will be given the position of upper left cell and 
                                lower right cell of the matrix.
                            </p>

                            <div class="matrix-example">
                                <h5>Example Matrix:</h5>
                                <div class="matrix-container">
                                    <table class="matrix-table">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th>Col 1</th>
                                                <th>Col 2</th>
                                                <th>Col 3</th>
                                                <th>Col 4</th>
                                                <th>Col 5</th>
                                                <th>Col 6</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="row-header">Row 1</td>
                                                <td>3</td>
                                                <td>5</td>
                                                <td>1</td>
                                                <td>16</td>
                                                <td>8</td>
                                                <td>13</td>
                                            </tr>
                                            <tr>
                                                <td class="row-header">Row 2</td>
                                                <td>12</td>
                                                <td>2</td>
                                                <td class="highlight">13</td>
                                                <td class="highlight">9</td>
                                                <td class="highlight">11</td>
                                                <td>6</td>
                                            </tr>
                                            <tr>
                                                <td class="row-header">Row 3</td>
                                                <td>7</td>
                                                <td>10</td>
                                                <td class="highlight">6</td>
                                                <td class="highlight">12</td>
                                                <td class="highlight">4</td>
                                                <td>7</td>
                                            </tr>
                                            <tr>
                                                <td class="row-header">Row 4</td>
                                                <td>11</td>
                                                <td>6</td>
                                                <td class="highlight">17</td>
                                                <td class="highlight">4</td>
                                                <td class="highlight">7</td>
                                                <td>18</td>
                                            </tr>
                                            <tr>
                                                <td class="row-header">Row 5</td>
                                                <td>8</td>
                                                <td>14</td>
                                                <td>7</td>
                                                <td>8</td>
                                                <td>12</td>
                                                <td>3</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <p class="matrix-caption">
                                    <strong>Query Example:</strong> Find the sum of submatrix from (2,3) to (4,5) 
                                    - highlighted cells above.
                                </p>
                            </div>
                        </div>

                        <!-- Solution -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-lightbulb me-3"></i>Solution Approaches
                            </h2>

                            <!-- Naive Approach -->
                            <div class="approach-section">
                                <h3 class="approach-title naive">
                                    <i class="bi bi-exclamation-triangle me-2"></i>Naive Approach
                                </h3>
                                
                                <p>
                                    Let's solve this problem naively first. We can run a simple nested 
                                    loop to find the sum:
                                </p>

                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-title">Naive Solution</span>
                                        <span class="complexity">Time: O(n²), Space: O(1)</span>
                                    </div>
                                    <pre><code class="language-cpp">int sum(int x1, int y1, int x2, int y2) {
    int sum = 0;
    for (int i = x1; i <= x2; i++) {
        for (int j = y1; j <= y2; j++) {
            sum += mat[i][j];
        }
    }
    return sum;
}</code></pre>
                                </div>

                                <div class="alert alert-warning">
                                    <i class="bi bi-exclamation-triangle me-2"></i>
                                    <strong>Problem:</strong> The complexity of this code is O(n²). 
                                    This code will easily fail for higher constraints.
                                </div>
                            </div>

                            <!-- Efficient Approach -->
                            <div class="approach-section">
                                <h3 class="approach-title efficient">
                                    <i class="bi bi-lightning me-2"></i>Efficient Approach - 2D Prefix Sum
                                </h3>

                                <p>
                                    Let's solve this problem efficiently using 2D prefix sums. We'll store 
                                    the cumulative sum of the matrix in such a way that <code>cell(i, j)</code> 
                                    will have cumulative sum of the submatrix having upper left 
                                    <code>cell(1, 1)</code> and lower right <code>cell(i, j)</code>.
                                </p>

                                <h4>Step 1: Building the Prefix Sum Array</h4>
                                
                                <p>
                                    Let's have another 2D matrix <code>csum</code> for storing the 
                                    cumulative sum of the matrix <code>mat</code>.
                                </p>

                                <div class="formula-box">
                                    <h5>Formula:</h5>
                                    <code>csum[i][j] = mat[i][j] + csum[i-1][j] + csum[i][j-1] - csum[i-1][j-1]</code>
                                </div>

                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-title">Building Prefix Sum</span>
                                        <span class="complexity">Time: O(n×m), Space: O(n×m)</span>
                                    </div>
                                    <pre><code class="language-cpp">void calc(int n, int m) {
    for (int i = 1; i <= n; i++) {
        for (int j = 1; j <= m; j++) {
            csum[i][j] = mat[i][j] + csum[i-1][j] + 
                         csum[i][j-1] - csum[i-1][j-1];
        }
    }
}</code></pre>
                                </div>

                                <h4>Step 2: Answering Queries</h4>
                                
                                <p>
                                    To find the sum of submatrix from <code>(x1, y1)</code> to 
                                    <code>(x2, y2)</code>, we use the inclusion-exclusion principle:
                                </p>

                                <div class="formula-box">
                                    <h5>Query Formula:</h5>
                                    <code>sum = csum[x2][y2] - csum[x2][y1-1] - csum[x1-1][y2] + csum[x1-1][y1-1]</code>
                                </div>

                                <div class="visual-explanation">
                                    <h5>Visual Explanation:</h5>
                                    <div class="explanation-steps">
                                        <div class="step">
                                            <span class="step-number">1</span>
                                            <span class="step-text">Take the entire area up to (x2, y2)</span>
                                        </div>
                                        <div class="step">
                                            <span class="step-number">2</span>
                                            <span class="step-text">Subtract the area above our target region</span>
                                        </div>
                                        <div class="step">
                                            <span class="step-number">3</span>
                                            <span class="step-text">Subtract the area to the left of our target region</span>
                                        </div>
                                        <div class="step">
                                            <span class="step-number">4</span>
                                            <span class="step-text">Add back the overlap (subtracted twice)</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="code-title">Query Function</span>
                                        <span class="complexity">Time: O(1), Space: O(1)</span>
                                    </div>
                                    <pre><code class="language-cpp">int query(int x1, int y1, int x2, int y2) {
    return csum[x2][y2] - csum[x2][y1-1] - 
           csum[x1-1][y2] + csum[x1-1][y1-1];
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Complete Implementation -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-code-slash me-3"></i>Complete Implementation
                            </h2>

                            <div class="code-block">
                                <div class="code-header">
                                    <span class="code-title">Complete C++ Solution</span>
                                    <span class="complexity">Overall: O(n×m + q) where q is number of queries</span>
                                </div>
                                <pre><code class="language-cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;

typedef long long int ll;
typedef pair&lt;ll, ll&gt; pll;

const int Max = 2e3 + 10;
const int Mod = 1e9 + 7;
const ll Inf = 1LL &lt;&lt; 62;

int mat[Max][Max];
int csum[Max][Max];

void calc(int n, int m) {
    for (int i = 1; i <= n; i++) {
        for (int j = 1; j <= m; j++) {
            csum[i][j] = mat[i][j] + csum[i-1][j] + 
                         csum[i][j-1] - csum[i-1][j-1];
        }
    }
}

int query(int x1, int y1, int x2, int y2) {
    return csum[x2][y2] - csum[x2][y1-1] - 
           csum[x1-1][y2] + csum[x1-1][y1-1];
}

int main(int argc, char const *argv[]) {
    int n, m, q, x1, y1, x2, y2;
    cin >> n >> m >> q;
    
    for (int i = 1; i <= n; i++) {
        for (int j = 1; j <= m; j++) {
            cin >> mat[i][j];
        }
    }
    
    calc(n, m);
    
    while (q--) {
        cin >> x1 >> y1 >> x2 >> y2;
        cout << query(x1, y1, x2, y2) << endl;
    }
    
    return 0;
}</code></pre>
                            </div>
                        </div>

                        <!-- Complexity Analysis -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-speedometer2 me-3"></i>Complexity Analysis
                            </h2>

                            <div class="complexity-table">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Operation</th>
                                            <th>Time Complexity</th>
                                            <th>Space Complexity</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Preprocessing</td>
                                            <td class="complexity-good">O(n × m)</td>
                                            <td class="complexity-good">O(n × m)</td>
                                        </tr>
                                        <tr>
                                            <td>Each Query</td>
                                            <td class="complexity-excellent">O(1)</td>
                                            <td class="complexity-excellent">O(1)</td>
                                        </tr>
                                        <tr>
                                            <td>Overall</td>
                                            <td class="complexity-good">O(n × m + q)</td>
                                            <td class="complexity-good">O(n × m)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Key Takeaways -->
                        <div class="content-section">
                            <h2 class="section-heading">
                                <i class="bi bi-key me-3"></i>Key Takeaways
                            </h2>

                            <div class="takeaways-grid">
                                <div class="takeaway-item">
                                    <i class="bi bi-check-circle"></i>
                                    <div>
                                        <h5>2D Prefix Sums</h5>
                                        <p>Powerful technique for range sum queries in 2D arrays</p>
                                    </div>
                                </div>
                                <div class="takeaway-item">
                                    <i class="bi bi-check-circle"></i>
                                    <div>
                                        <h5>Inclusion-Exclusion</h5>
                                        <p>Essential principle for avoiding double counting</p>
                                    </div>
                                </div>
                                <div class="takeaway-item">
                                    <i class="bi bi-check-circle"></i>
                                    <div>
                                        <h5>O(1) Queries</h5>
                                        <p>After O(n×m) preprocessing, answer queries in constant time</p>
                                    </div>
                                </div>
                                <div class="takeaway-item">
                                    <i class="bi bi-check-circle"></i>
                                    <div>
                                        <h5>Space-Time Tradeoff</h5>
                                        <p>Use extra space to achieve faster query times</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation -->
                        <div class="tutorial-navigation">
                            <a href="index.html" class="nav-btn prev">
                                <i class="bi bi-arrow-left me-2"></i>
                                Back to Tutorials
                            </a>
                            <a href="subtree-update-query-preprocess.html" class="nav-btn next">
                                Next Tutorial
                                <i class="bi bi-arrow-right ms-2"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="modern-footer">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="footer-brand">
                        <h5 class="mb-2">Md. Emrul Chowdhury</h5>
                        <p class="mb-0 text-muted">Software Development Engineer</p>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="social-links">
                        <a href="mailto:emrul.chy@gmail.com" class="social-link" title="Email">
                            <i class="bi bi-envelope"></i>
                        </a>
                        <a href="https://github.com/emrul-chy" target="_blank" class="social-link" title="GitHub">
                            <i class="bi bi-github"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/emrul-cse/" target="_blank" class="social-link" title="LinkedIn">
                            <i class="bi bi-linkedin"></i>
                        </a>
                        <a href="https://www.facebook.com/emrul.cse" target="_blank" class="social-link" title="Facebook">
                            <i class="bi bi-facebook"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <hr class="footer-divider">
            
            <div class="row">
                <div class="col-12 text-center">
                    <p class="copyright mb-0">
                        © 2025 emrul.ch | Built with ❤️ by Md. Emrul Chowdhury
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Prism.js for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- Custom JS -->
    <script src="../js/modern-script.js"></script>
</body>
</html>
